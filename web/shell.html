<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>ðŸ¦Ž Lizard! Lizard! Lizard!!! ðŸ¦Ž</title>

    <meta name="title" content="ðŸ¦Ž Lizard! Lizard! Lizard!!! ðŸ¦Ž">
    <meta name="description" content="A fun web game built with raylib">
    <meta name="keywords" content="game, lizard, web, html5">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
      body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #1a1a1a;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        overflow: hidden;
      }

      h1 {
        color: #4CAF50;
        margin: 5px 0;
        text-align: center;
        font-size: 1.2em;
        font-weight: bold;
      }

      .game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #2a2a2a;
        padding: 5px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        max-width: 95vw;
        max-height: 95vh;
        box-sizing: border-box;
      }

      .canvas-container {
        border: 2px solid #4CAF50;
        border-radius: 5px;
        background: black;
        margin: 2px 0;
        display: flex;
        justify-content: center;
        align-items: center;
        max-width: 100%;
        max-height: calc(95vh - 60px);
      }

      /* Canvas must not have any border or padding, or mouse coords will be wrong */
      canvas.emscripten {
        border: 0px none;
        background: black;
        display: block;
        max-width: 100%;
        max-height: 100%;
        width: auto;
        height: auto;
      }

      .controls {
        display: flex;
        gap: 8px;
        margin: 2px 0;
        flex-wrap: wrap;
        justify-content: center;
      }

      .status-area {
        text-align: center;
        margin: 2px 0;
      }

      .spinner {
        height: 15px;
        width: 15px;
        margin: 0 auto 5px;
        display: inline-block;
        animation: rotation 0.8s linear infinite;
        border-left: 2px solid #666;
        border-right: 2px solid #666;
        border-bottom: 2px solid #666;
        border-top: 2px solid #4CAF50;
        border-radius: 100%;
        background-color: transparent;
      }

      @keyframes rotation {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      #status {
        color: #4CAF50;
        font-weight: bold;
        margin-top: 5px;
        font-size: 0.9em;
      }

      #progress {
        width: 200px;
        height: 8px;
        margin: 5px auto;
        border-radius: 5px;
        background-color: #333;
      }

      button {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 8px 15px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 12px;
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #45a049;
      }

      button:active {
        background-color: #3d8b40;
      }

      .hidden {
        display: none !important;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        h1 {
          font-size: 1em;
        }
        
        button {
          padding: 6px 12px;
          font-size: 11px;
        }
        
        .game-container {
          padding: 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="status-area">
        <div class="spinner" id='spinner'></div>
        <div id="status">Loading...</div>
        <progress id="progress" max="100" value="0"></progress>
      </div>

      <div class="controls">
        <button id="btn-fullscreen" onclick="Module.requestFullscreen(false, false)">ðŸ–µ Fullscreen</button>
        <button id="btn-audio" onclick="toggleAudio()">ðŸ”‡ Mute</button>
      </div>

      <div class="canvas-container">
        <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex=-1></canvas>
      </div>
    </div>

    <script type='text/javascript'>
        var statusElement = document.querySelector('#status');
        var progressElement = document.querySelector('#progress');
        var spinnerElement = document.querySelector('#spinner');
        
        var Module = {
            preRun: [],
            postRun: [],
            print: function(text) {
                // Suppress console output in release builds
                console.log(text);
            },
            printErr: function(text) {
                console.error(text);
            },
            canvas: (function() {
                var canvas = document.querySelector('#canvas');
                canvas.addEventListener("webglcontextlost", function(e) { 
                    alert('WebGL context lost. You will need to reload the page.'); 
                    e.preventDefault(); 
                }, false);
                return canvas;
            })(),
            setStatus: function(text) {
                if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
                if (text === Module.setStatus.last.text) return;

                var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
                var now = Date.now();

                if (m && now - Module.setStatus.last.time < 30) return;

                Module.setStatus.last.time = now;
                Module.setStatus.last.text = text;

                if (m) {
                    text = m[1];
                    progressElement.value = parseInt(m[2])*100;
                    progressElement.max = parseInt(m[4])*100;
                    progressElement.classList.remove('hidden');
                    spinnerElement.classList.remove('hidden');
                } else {
                    progressElement.value = null;
                    progressElement.max = null;
                    progressElement.classList.add('hidden');
                    if (!text) {
                        spinnerElement.classList.add('hidden');
                        statusElement.innerHTML = '';
                        return;
                    }
                }

                statusElement.innerHTML = text;
            },
            totalDependencies: 0,
            monitorRunDependencies: function(left) {
                this.totalDependencies = Math.max(this.totalDependencies, left);
                Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
            }
        };

        Module.setStatus('Downloading...');

        window.onerror = function() {
            Module.setStatus('Exception thrown, see JavaScript console');
            spinnerElement.classList.add('hidden');
            Module.setStatus = function(text) { 
                if (text) console.error('[post-exception status] ' + text); 
            };
        };
    </script>

    <script type='text/javascript'>
        var audioBtn = document.querySelector('#btn-audio');
        const audioContexList = [];
        
        (function() {
            self.AudioContext = new Proxy(self.AudioContext, {
                construct(target, args) {
                    const result = new target(...args);
                    audioContexList.push(result);
                    if (result.state == "suspended") audioBtn.textContent = "ðŸ”ˆ Unmute";
                    return result;
                }
            });
        })();

        function toggleAudio() {
            var resumed = false;
            audioContexList.forEach(ctx => {
                if (ctx.state == "suspended") { 
                    ctx.resume(); 
                    resumed = true; 
                } else if (ctx.state == "running") {
                    ctx.suspend();
                }
            });

            audioBtn.textContent = resumed ? "ðŸ”‡ Mute" : "ðŸ”ˆ Unmute";
        }
    </script>
    {{{ SCRIPT }}}
  </body>
</html>